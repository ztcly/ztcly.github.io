<!DOCTYPE html><html lang="zh-cn" theme-mode="dark"><head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="/css/bilicard.css">
<!-- hexo injector head_begin end --><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>首篇文章：站点建立过程 | ztcly</title><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - 共 $1 行","copy":"复制","copyFinish":"复制成功","expand":"展开"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="/css/bilicard.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><!-- hexo injector head_end start -->
<link rel="stylesheet" href="/css/collapse.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>首篇文章：站点建立过程</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-02-09T09:02:41.000Z" id="date"> 2023-02-09</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-02-14T06:00:45.134Z" id="updated"> 2023-02-14</time></div></span><br><span>文章总字数: <div class="control">1.7k</div></span><br><span>预计阅读时间: <div class="control">6 分钟</div></span></div></div><hr><div id="post-content"><link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>本文记叙了站点从开始建立、配置首页Live2D插件&#x2F;脚本、在本地搭建Live2D Api遇到的问题和过程。<br>本文约1.7K字，阅读时长约 5 分钟</p>
<span id="more"></span>

<h2 id="站点建立：顺利的前半程"><a href="#站点建立：顺利的前半程" class="headerlink" title="站点建立：顺利的前半程"></a>站点建立：顺利的前半程</h2><p>站点的博客部分采用hexo。通过hexo搭建博客已经有较为成熟的教程<br>安装前置，再安装本体，最后选择一个好看的主题装上去（我在这里选择的是<a target="_blank" rel="noopener" href="https://molunerfinn.com/hexo-theme-melody-doc/">hexo-theme-melody</a>）<br>简单而方便的配置使得从我在搜索引擎敲下第一个问题“Hexo 搭建”到我能够开始写下这篇文档的前半部分只花了几十分钟——大部分时间还都在下载文件上。  </p>
<p>一切都非常的顺利，直到我在好奇中看到了melody主题配置的额外选项<a href="%5Bhexo-theme-melody%5D(https://molunerfinn.com/hexo-theme-melody-doc/)">Live2D Model</a></p>
<h2 id="弄个Live2D：探索的后半程"><a href="#弄个Live2D：探索的后半程" class="headerlink" title="弄个Live2D：探索的后半程"></a>弄个Live2D：探索的后半程</h2><p>看到Live2D模块的效果图，我也想打算整一个<br>根据教程的指导，需要输入指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">npm install --save hexo-helper-live2d<br></code></pre></td></tr></table></figure>

<p>问题从这里就开始了，下载完成之后报了错</p>
<p>错误大概长这个样子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">XX vulnerabilities (XX moderate, X high, X critical) <br>To address all issues (including breaking changes), run: <br><br>npm audit fix --force <br><br>Run `npm audit` for details.<br></code></pre></td></tr></table></figure>

<p>这里的意思是说npm安装时发现了很多漏洞，这里会显示出现问题的数量和等级。<br>通过搜索引擎的查找，解决方案是<code>npm audit fix</code>→<code>npm audit fix --force</code>等指令。<br>在执行的指令的时候，系统会给出各个问题的详情和修复。有的问题通过<code>npm audit fix</code>就可以修复，有的问题需要<code>npm audit fix --force</code>能进行修复，而还有很多问题根本没有给出修复。  </p>
<p>在项目的<a target="_blank" rel="noopener" href="https://github.com/EYHN/hexo-helper-live2d">Github页面</a>上显示它已经不再维护，可以用另一个相似的项目<a target="_blank" rel="noopener" href="https://github.com/stevenjoezhang/live2d-widget">Live2D Widget</a><br><img src="/images/FirstPost/pic01.jpg" alt="不再维护"></p>
<p>所以，安装进行到这里我选择换用<a target="_blank" rel="noopener" href="https://github.com/stevenjoezhang/live2d-widget">Live2D Widget</a><br>在Live2D Widget的页面<a target="_blank" rel="noopener" href="https://github.com/stevenjoezhang/live2d-widget#%E4%BD%BF%E7%94%A8-usage">说明</a>中，应当把</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script src=<span class="hljs-string">&quot;https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js&quot;</span>&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p>加入到页面的<code>&lt;head&gt;</code>或者<code>&lt;body&gt;</code>中，如果使用的是 Hexo，那么需要在主题的模版文件中添加以上代码。</p>
<p>那么下一步是寻找主题的模板文件：melody主题的<a target="_blank" rel="noopener" href="https://molunerfinn.com/hexo-theme-melody-doc/zh-Hans/#%E7%89%B9%E6%80%A7">特性页面</a>有提到使用了pug模板引擎。再对pug进行搜索，可以看到在主题的layout文件夹下有很多pug，根据文件名和文件夹名推测这里便是存储模板文件的地方。</p>
<blockquote>
<p>这里服务器是Windows Server 2022，选择这个系统另有原因</p>
</blockquote>
<p><img src="/images/FirstPost/pic02.jpg" alt="pug"></p>
<p>考虑到我的目的是在主页添加Live2D，现在应当对index.pug进行编辑。<br>index.pug的内容打开如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pug">extends includes/layout.pug<br><br>block content<br>  include includes/recent-posts.pug<br>  include includes/pagination.pug<br></code></pre></td></tr></table></figure>

<p>截止到这里，我目前对于pug的语法还是一无所知。好在我需要进行的不是什么复杂操作，可以通过分析别的文件来推测如何操作。我的目标操作是添加一个<code>&lt;script&gt;</code>进去，所以在这里使用VS Code的多文件查找功能查找<code>script</code>关键词。<br>在多个文件中我看到了这样的写法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pug">script(src=...)<br></code></pre></td></tr></table></figure>

<p>将src补充完整可得</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pug">script(src=&quot;http://localhost:4000/live2d-widget-master/autoload.js&quot;)<br></code></pre></td></tr></table></figure>

<p>最后将语句放入<code>index.pug</code>，重新生成并部署。</p>
<h2 id="成功了，但只成功了一半"><a href="#成功了，但只成功了一半" class="headerlink" title="成功了，但只成功了一半"></a>成功了，但只成功了一半</h2><p>页面刷新完成之后，左下角成功出现了对话框、功能按钮等等组件。可唯独图片没有显示，空无一物。<br>再继续对新的问题进行搜索，这次在<a target="_blank" rel="noopener" href="https://github.com/stevenjoezhang/live2d-widget/issues/127">issue</a>和<a target="_blank" rel="noopener" href="https://duanjinrong.com/article/41f6850c-35ff-408d-9596-0ec057048165">下方回复中的另一个帖子</a>中找到了问题所在  </p>
<blockquote>
<p>然鹅，之前展示的好好的萌娘这次几乎全挂，又或者加载很慢，究其原因还是因为jsdeliver提供的cdn服务在中国被软墙，将后端api由jsdeliver更换为fghrsh提供的后端之后有所改善，但由于前端代码也挂载在jsdeliver，因此依然可能出现无法稳定加载的问题。<br>最后还是将所有资源挂载到了本地才解决这一问题。 </p>
<p>原文:<a target="_blank" rel="noopener" href="https://duanjinrong.com/article/41f6850c-35ff-408d-9596-0ec057048165">live2d部署实践</a></p>
</blockquote>
<p>帖子的作者提供了自建的api，但考虑到为了让自己站点的Live2的访问更稳定，最终还是选择试着将模型文件存储在本地。</p>
<p>在插件的Github页面有提到过<a target="_blank" rel="noopener" href="https://github.com/fghrsh/live2d_api">live2d_api</a>相关的内容,将这个后端api下载到本地发现是一堆的php文件。<br>对于php我依旧是知之甚少，所以对于这个东西的运行只能继续求助于搜索引擎。<br>搜索引擎的很多回答都提到了构建一个Apache+PHP+MySQL环境的教程。考虑到这个api用不到MySQL，先安装Apache和PHP环境。<br>下载并解压二者，随后开始配置。<br>Apache需要先指定目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs conf">Define SRVROOT &quot;C:/Users/ztcly/Apache24&quot;<br></code></pre></td></tr></table></figure>

<p>Apache需要php模块：  </p>
<blockquote>
<p>这里如果加载的是php7的话，应当写<code>LoadModule php7_module &quot;...&quot;</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs conf">LoadModule php_module &quot;C:/Users/ztcly/php-8.2.1-Win32-vs16-x64/php8apache2_4.dll&quot; <br>PHPIniDir &quot;C:/Users/ztcly/php-8.2.1-Win32-vs16-x64&quot;<br>AddType application/x-httpd-php .php .html .htm<br></code></pre></td></tr></table></figure>

<p>按照教程，php文件应该放在<code>/htdocs</code>目录下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs conf">DocumentRoot &quot;$&#123;SRVROOT&#125;/htdocs&quot;<br></code></pre></td></tr></table></figure>

<p>创建完成之后启动Apache，待服务正常启动。<br>之后根据api教程中的说明更改Autoload.js中的apiPath字段，将其更改成Apache的地址和端口号，最后刷新页面。  </p>
<h2 id="老问题"><a href="#老问题" class="headerlink" title="老问题"></a>老问题</h2><p>刷新页面之后，模型的位置依旧是空白。但是这次在浏览器控制台的报错就是我所认识的了,它大概长这个样子:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Access to XMLHttpRequest at ‘xxx’ from origin ‘xxx’ has been blocked by CORS policy: No ‘Access-Control-Allow-Origin’ header is present on the requested resource.<br></code></pre></td></tr></table></figure>

<p>这是十分明显的跨域问题，请求被CORS策略所阻止了。<br>修改Apache&#x2F;htdocs的CORS策略(xxxx为来源)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">DocumentRoot &quot;$&#123;SRVROOT&#125;/htdocs&quot;<br>&lt;Directory &quot;$&#123;SRVROOT&#125;/htdocs&quot;&gt;<br>    ExecCGI MultiViews<br>    Options Indexes FollowSymLinks<br>    AllowOverride None<br>    Header set Access-Control-Allow-Origin xxxx<br>    Require all granted<br>    Allow from xxxx<br>&lt;/Directory&gt;<br></code></pre></td></tr></table></figure>

<p>继续重启服务，重新生成，再部署——还是不能用<br>检查控制台报错：<code>Uncaught SyntaxError: Unexpected token &#39;&lt;&#39;</code></p>
<p>等会，它给我传了点什么过来？<br>问题就出在上面那段配置中——Options <strong>Indexes</strong> FollowSymLinks<br>这里Indexes的作用就是当该目录下没有指定 index.html 文件时，就显示目录结构。也就是它传过来的东西是htdocs下的目录结构，以HTML形式。报错中提到的’&lt;’就是<code>&lt;!DOCTYPE html&gt;</code>左边的”&lt;”</p>
<p>删除掉Indexes，并且为这个api指定一个用不上的首页：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">phpinfo</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>最后重启，终于成功了，芜湖</p>
<p><img src="/images/FirstPost/pic03.jpg" alt="成功了"></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-start"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/02/14/PluginTest/">← Next 部分插件用法及测试</a></div></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="文章目录">≡</a><a id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://www.ztcly.top/images/SitePics/head.png" alt="Logo"></a><h1 id="Dr"><a href="/">ztcly</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%91%98%E8%A6%81"><span class="toc-number">1.</span> <span class="toc-text">摘要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%99%E7%82%B9%E5%BB%BA%E7%AB%8B%EF%BC%9A%E9%A1%BA%E5%88%A9%E7%9A%84%E5%89%8D%E5%8D%8A%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">站点建立：顺利的前半程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%84%E4%B8%AALive2D%EF%BC%9A%E6%8E%A2%E7%B4%A2%E7%9A%84%E5%90%8E%E5%8D%8A%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">弄个Live2D：探索的后半程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%90%E5%8A%9F%E4%BA%86%EF%BC%8C%E4%BD%86%E5%8F%AA%E6%88%90%E5%8A%9F%E4%BA%86%E4%B8%80%E5%8D%8A"><span class="toc-number">4.</span> <span class="toc-text">成功了，但只成功了一半</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%81%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">老问题</span></a></li></ol></div></div><footer><nobr><span class="text-title">作者</span><span class="text-content">ztcly</span></nobr><br><nobr><span class="text-title">©</span><span class="text-content">2023</span></nobr><br><nobr><span class="text-title">许可协议</span><span class="text-content">WTFPL</span></nobr><br><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{code.findCode();}</script><script src="/live2d-widget-master/autoload.js"></script><script src="/js/arknights.js"></script><script src="/js/pjax.js"></script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><!-- hexo injector body_end start -->
<script src="/js/collapse.js"></script>
<!-- hexo injector body_end end --></body></html>